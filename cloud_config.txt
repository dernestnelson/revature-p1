#cloud-config
package_update: true
packages:
    - build-essential
    - curl
    - file
    - git
    - nodejs
    - npm
write_files:
    -   owners: 'david:david'
        path: '/home/david/index.js'
        content: |
            
            const http = require('http');

            const hostname = '0.0.0.0';
            const port = 8000;

            const server = http.createServer((req, res) => {
                res.statusCode = 200;
                res.setHeader('Content-Type', 'text/html');
                res.end('<h1>Hello David</h1>');
            });

            server.listen(port, hostname, () => {
                console.log(`Server running at http://${hostname}:${port}/`);
            });

runcmd:
    - cd '/home/david/'
    - sudo mkfs -t ext4 /dev/sdc
    - sudo mkdir /media/diskholder
    - sudo mount /dev/sdc /media/diskholder
    - sudo mv index.js /media/diskholder/
    - sudo npm init -y
    - sudo npm install express
    - sudo mv package.json /media/diskholder/
    - cd '/media/diskholder'
    - node index.js